# COPIED FROM https://gist.github.com/rehno-lindeque/36e1e5720ca05f89e985fc7b62f54158

ifdef VERBOSE
	Q =
	E = @true 
else
	Q = @
	E = @echo 
endif

CFILES := $(shell find src -mindepth 1 -maxdepth 4 -name "*.c")

INFILES := $(CFILES) 

OBJFILES := $(CFILES:src/%.c=%)
DEPFILES := $(CFILES:src/%.c=%)
OFILES := $(OBJFILES:%=obj/%.o)

BINFILE = drunt

COMMONFLAGS = -Wall -Wextra -pedantic
LDFLAGS =

ifdef DEBUG
	COMMONFLAGS := $(COMMONFLAGS) -g
endif
CFLAGS = $(COMMONFLAGS) --std=c99
DEPDIR = deps
all: $(BINFILE)
ifeq ($(MAKECMDGOALS),)
-include Makefile.dep
endif
ifneq ($(filter-out clean, $(MAKECMDGOALS)),)
-include Makefile.dep
endif

CC = i686-w64-mingw32-gcc
LIBS = `pkg-config --libs gtk+-3.0`
PACKAGE = `pkg-config --cflags --libs gtk+-3.0`

-include Makefile.local

.PHONY: clean all depend
.SUFFIXES:
obj/%.o: src/%.c
	$(E)C-compiling $<
	$(Q)if [ ! -d `dirname $@` ]; then mkdir -p `dirname $@`; fi
	$(Q)$(CC) -o $@ -c $< $(CFLAGS) $(PACKAGE)
	
$(BINFILE): $(OFILES)
	$(E)Linking $@
	$(Q)$(CXX) -o $@ $(OFILES) $(LDFLAGS) $(LIBS)
clean:
	@$(RM) -rvf obj/* $(BINFILE) 
